---
title: "R data skills"
author: "lmj"
date: "2023-05-05"
output: 
  bookdown::gitbook:
    split_by: none
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,collapse = TRUE)
library(tidyverse)
```

+ ğŸ“¢æœ¬å†…å®¹ä¸º**Rè¯­è¨€æ•°æ®åˆ†æ**çš„ä¸€äº›å°æŠ€å·§ï¼Œ**ä¸å®šæœŸæ›´æ–°**
+ ğŸ®[gitbookç‰ˆæœ¬](https://rpubs.com/Chris622/R-skills)
+ ğŸ’»[websiteç‰ˆæœ¬]()

# ç›®å½•

+ [Data transformation|æ•°æ®è½¬æ¢](#transformation)
  + [æŸ¥çœ‹ç¼ºå¤±å€¼æ•°ç›®](#count-na)
  + [æŸ¥çœ‹æ•°æ®ä¸­å¯ä»¥å˜æˆå› å­å‹çš„å˜é‡](#find-fct)
  + [æŒ‰æ¡ä»¶ç»™è§‚æµ‹åˆ†ç»„ï¼Œå¹¶å®šä¹‰ä¸ºæ–°å˜é‡](#case-when)
  + [å°†ä¸å¸¸è§å› å­åˆå¹¶ä¸ºâ€œå…¶ä»–â€](#fct-lump)
  + [ç”¨ç‰¹å®šæ•°æ®ä»£æ›¿åŸå§‹æ•°æ®ä¸­çš„NA](#replace-na)
+ [Data tidying|æ•°æ®æ•´ç†](#tidy)
+ [Data visualization|æ•°æ®å¯è§†åŒ–](#viz)
+ [Others|å…¶ä»–](#others)
  + [å°†æ•°æ®éšæœºåˆ†ä¸ºæµ‹è¯•é›†å’Œè®­ç»ƒé›†](#sample-data)


# Data transformation|æ•°æ®è½¬æ¢ {#transformation}
## æŸ¥çœ‹ç¼ºå¤±å€¼æ•°ç›®{#count-na}
+ `sum(is.na())`
+ `colSums(is.na())`
+ `rowSums(is.na())`
```{r}
X <- c(1,2,NA,4,5)
Y <- c('a','','c','','e')
Z <- c(NA,'B',NA,'D','E')
df <- data.frame(X,Y,Z,row.names = c(1,2,3,4,5))
df
sum(is.na(X))
sum(is.na(Z))
colSums(is.na(df))
rowSums(is.na(df))

#is.na()è¿˜å¯ä»¥æ›¿æ¢æˆå…¶ä»–æ¡ä»¶åˆ¤æ–­ï¼Œå¦‚
sum(Y=='')
```


## æŸ¥çœ‹æ•°æ®ä¸­å¯ä»¥å˜æˆå› å­å‹çš„å˜é‡{#find-fct}
+ æŸ¥çœ‹æ•°æ®å”¯ä¸€å€¼çš„æ•°ç›®ï¼Œæ•°ç›®å°‘çš„è¯´æ˜ä¸ºfactorå› å­å˜é‡
+ `unique()` æå–å”¯ä¸€å€¼
+ `length()` è®¡ç®—å‘é‡é•¿åº¦
+ `map_dbl()` å¯¹æ¯ä¸ªåˆ—è¿›è¡Œè®¡ç®—ï¼Œå¹¶è¿”å›doubleå‘é‡
```{r}
#ä»¥mtcarsä¸ºä¾‹
glimpse(mtcars)
map_dbl(mtcars,~length(unique(.)))
#cyl, vs, am, gear, carb å”¯ä¸€å€¼æ•°ç›®å°‘ï¼Œè¯´æ˜å¯ä»¥è½¬æ¢ä¸ºå› å­

#é‡‡ç”¨forå¾ªç¯è¿›è¡Œè½¬æ¢
cols <- c('cyl', 'vs', 'am', 'gear', 'carb' )
for (i in cols){
  mtcars[,i] <- as.factor(mtcars[,i])
}
#æŸ¥çœ‹è½¬æ¢åçš„æ•°æ®
glimpse(mtcars)
```
## æŒ‰æ¡ä»¶ç»™è§‚æµ‹åˆ†ç»„ï¼Œå¹¶å®šä¹‰ä¸ºæ–°å˜é‡{#case-when}
+ `case_when()`æŒ‰æ¡ä»¶åˆ†ç»„
+ `mutate()`å®šä¹‰æ–°å˜é‡
```{r}
# ä»¥starwarsæ•°æ®ä¸ºä¾‹
head(starwars)
# æŒ‰ç…§èº«é«˜heightï¼Œä½“é‡massï¼Œç§ç±»speciesç»™äººç‰©åˆ†ç±»
starwars %>%
  select(name:mass, gender, species) %>%
  mutate(
    type = case_when(
      height > 200 | mass > 200 ~ "large",#å¤§å‹ç‰©ç§
      species == "Droid" ~ "robot",#æœºå™¨äºº
      .default = "other"#å…¶ä»–
    )
  )

```




## å°†ä¸å¸¸è§å› å­åˆå¹¶ä¸ºâ€œå…¶ä»–â€{#fct-lump}
+ fct_lump_min():åˆå¹¶å‡ºç°æ¬¡æ•°å°‘äºminçš„çº§åˆ«ã€‚
+ fct_lump_prop():å°†é¢‘ç‡å°‘äº(æˆ–ç­‰äº)propçš„çº§åˆ«åˆå¹¶ã€‚
+ fct_lump_n():ä¿ç•™nä¸ªæœ€é¢‘ç¹çš„(å¦‚æœn<0ï¼Œåˆå¹¶-nä¸ªæœ€ä¸é¢‘ç¹çš„)
+ fct_lump_lowfreq()å°†é¢‘ç‡æœ€ä½çš„çº§åˆ«é›†ä¸­åœ¨ä¸€èµ·ï¼Œå¹¶ç¡®ä¿â€œotherâ€ä»ç„¶æ˜¯æœ€å°çš„çº§åˆ«ã€‚
```{r}
x <- factor(rep(LETTERS[1:9], times = c(40, 10, 5, 27, 1, 1, 1, 1, 1)))
x %>% table()
#ä¿ç•™3ä¸ªæœ€é¢‘ç¹çš„
x %>%
  fct_lump_n(3) %>%
  table()
# ä¿ç•™é¢‘ç‡>0.10çš„
x %>%
  fct_lump_prop(0.10) %>%
  table()
# ä¿ç•™é¢‘æ¬¡>=5çš„
x %>%
  fct_lump_min(5) %>%
  table()
# å°†é¢‘ç‡æœ€ä½çš„çº§åˆ«é›†ä¸­åœ¨ä¸€èµ·ï¼Œå¹¶ç¡®ä¿â€œotherâ€ä»ç„¶æ˜¯æœ€å°çš„çº§åˆ«ã€‚
x %>%
  fct_lump_lowfreq() %>%
  table()
```


## ç”¨ç‰¹å®šæ•°æ®ä»£æ›¿åŸå§‹æ•°æ®ä¸­çš„NA{#replace-na}
+ `replace_na()`
```{r}
# æ›¿æ¢æˆunknown
df <- tibble(x = c(1, 2, NA), y = c("a", NA, "b"))
df %>% replace_na(list(x = 0, y = "unknown"))
# æ›¿æ¢æˆå¹³å‡å€¼
df <- tibble(ID = c(1:6), age = c(20,24,NA,23,25,27))
df %>% replace_na(list(age=mean(df$age,na.rm = T)))
```

# Data tidying|æ•°æ®æ•´ç† {#tidy}

# Data visualization|æ•°æ®å¯è§†åŒ– {#viz}
# Others|å…¶ä»–{#others}
## å°†æ•°æ®éšæœºåˆ†ä¸ºæµ‹è¯•é›†å’Œè®­ç»ƒé›†{#sample-data}
```{r eval=FALSE}
set.seed(123)# Set a random seed
ind<-sample(1:dim(data)[1],500) # å–æ ·500å½“è®­ç»ƒé›†ï¼Œå‰©ä¸‹æµ‹è¯•
train<-data[ind,] # The train set of the model
test<-data[-ind,] # The test set of the model
```

